<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code & Connect - AlumniConnect</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@supabase/supabase-js"></script>

    <style>
        /* 1. GLOBAL STYLES & SETUP */
        *, *::before, *::after {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

        :root {
          --color-background: #100E19;
          --color-primary: #8A4FFF;
          --color-primary-hover: #7B46E5;
          --color-card-background: #1C1A27;
          --color-border: #2A2836;
          --text-primary: #EAEAEB;
          --text-secondary: #9A9A9E;
          --color-white: #FFFFFF;
          --color-gold: #FFD700;
          --color-silver: #C0C0C0;
          --color-bronze: #CD7F32;
          --sidebar-collapsed-width: 90px;
          --sidebar-expanded-width: 280px;
        }

        body {
          font-family: 'Poppins', sans-serif;
          color: var(--text-primary);
          background-color: var(--color-background);
          background-image: 
            radial-gradient(circle at 15% 50%, rgba(138, 79, 255, 0.1), transparent 30%),
            radial-gradient(circle at 85% 30%, rgba(138, 79, 255, 0.1), transparent 40%);
          overflow-y: auto;
        }

        a { text-decoration: none; color: inherit; }
        ul { list-style: none; }

        .sidebar-left {
          position: fixed; top: 0; left: 0; height: 100vh;
          background-color: var(--color-card-background);
          padding: 1.5rem; display: flex; flex-direction: column;
          z-index: 100; overflow: hidden;
          width: var(--sidebar-collapsed-width);
          transition: width 0.3s ease-in-out;
          border-right: 1px solid var(--color-border);
        }
        .sidebar-left:hover { width: var(--sidebar-expanded-width); }
        .profile-toggle { display: flex; align-items: center; gap: 1rem; height: 60px; flex-shrink: 0; }
        .profile-info { opacity: 0; transition: opacity 0.2s ease-in-out; white-space: nowrap; }
        .sidebar-left:hover .profile-info { opacity: 1; }
        .profile-avatar-main { width: 50px; height: 50px; border-radius: 12px; object-fit: cover; flex-shrink: 0; padding: initial;}
        .sidebar-content { margin-top: 2rem; flex-grow: 1; display: flex; flex-direction: column; opacity: 0; transition: opacity 0.3s ease-in-out; white-space: nowrap; }
        .sidebar-left:hover .sidebar-content { opacity: 1; }
        .sidebar-nav { flex-grow: 1; }
        .nav-link { display: flex; align-items: center; gap: 1rem; padding: 1rem; border-radius: 12px; font-weight: 500; }
        .nav-link.active { background-color: var(--color-primary); color: var(--color-white); }
        .nav-link:hover { background-color: var(--color-border); }
        .nav-link.active svg, .nav-link:hover svg { color: var(--color-white); }
        .nav-link svg { color: var(--text-secondary); transition: color 0.2s; flex-shrink: 0; }
        .btn-logout { background-color: var(--color-primary); color: var(--color-white); padding: 1rem; border-radius: 12px; font-weight: 600; text-align: center; }
        .btn-logout:hover { background-color: var(--color-primary-hover); }

        .main-wrapper {
          margin-left: var(--sidebar-collapsed-width);
          display: grid;
          grid-template-columns: 1fr 380px; 
          gap: 2rem;
          padding: 2rem;
          transition: margin-left 0.3s ease-in-out;
        }
        .sidebar-left:hover ~ .main-wrapper {
          margin-left: var(--sidebar-expanded-width);
        }

        /* 4. MAIN CONTENT AREA (LEFT & MIDDLE) */
        .main-content h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 2rem;
        }

        .coders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .coder-card {
            background-color: var(--color-card-background);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--color-border);
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .coder-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .coder-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--color-primary);
        }

        .coder-info h3 { font-size: 1.2rem; font-weight: 600; }
        .coder-info p { color: var(--text-secondary); font-size: 0.9rem; }
        
        .coder-socials {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid var(--color-border);
        }

        .social-link {
            color: var(--text-secondary);
            transition: color 0.2s ease, transform 0.2s ease;
        }
        .social-link:hover {
            color: var(--color-primary);
            transform: translateY(-2px);
        }
        .social-link svg {
            width: 24px;
            height: 24px;
        }

        .view-profile-btn {
            margin-top: auto;
            background: none;
            border: 1px solid var(--color-primary);
            color: var(--color-primary);
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .view-profile-btn:hover {
            background-color: var(--color-primary);
            color: var(--color-white);
        }


        /* 5. LEADERBOARD (RIGHT SIDEBAR) */
        .leaderboard-container {
            position: sticky;
            top: 2rem;
            height: calc(100vh - 4rem);
        }
        .leaderboard-card {
            background-color: var(--color-card-background);
            border-radius: 16px;
            padding: 1.5rem;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .leaderboard-card h2 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .leaderboard-list {
            list-style: none;
            flex-grow: 1;
            overflow-y: auto;
        }
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-radius: 8px;
            transition: background-color 0.2s ease;
        }
        .leaderboard-item:not(:last-child){
            margin-bottom: 0.5rem;
        }
        .leaderboard-item:hover {
            background-color: var(--color-border);
        }
        
        .rank {
            font-size: 1.1rem;
            font-weight: 700;
            width: 40px;
            flex-shrink: 0;
            text-align: center;
        }
        .rank.gold { color: var(--color-gold); }
        .rank.silver { color: var(--color-silver); }
        .rank.bronze { color: var(--color-bronze); }

        .leaderboard-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 1rem;
        }
        .leaderboard-name {
            font-weight: 500;
            flex-grow: 1;
        }
        .leaderboard-score {
            font-weight: 600;
            color: var(--color-primary);
        }
        .profile-link {
            text-decoration: none; /* remove underline */
            display: block; /* makes the whole div clickable */
        }

        .profile-toggle {
            padding: 8px;
            border-radius: 8px;
            transition: background-color 0.2s ease;
        }

        .profile-toggle:hover {
            background-color: #646464; 
            cursor: pointer;
        }
    </style>
</head>
<body>
<div class="flex h-screen overflow-hidden">
    <aside id="sidebar" class="sidebar-left">
        <a href="profileN.html" class="profile-link">
            <div class="profile-toggle">
                <img id="s-img" src="" alt="Profile pic" class="profile-avatar-main">
                <div class="profile-info">
                <h3 id="s-name" class="profile-name"></h3>
                <p id = "s-title" class="profile-title"></p>
                </div>
            </div>
        </a>
        
        <div class="sidebar-content">
            <nav class="sidebar-nav">
              <ul>
                <li><a href="feed.html" class="nav-link">
                    <svg class="shrink-0" fill="currentColor" height="24" viewBox="0 0 256 256" width="24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M224,115.55V208a16,16,0,0,1-16,16H168a16,16,0,0,1-16-16V168a8,8,0,0,0-8-8H112a8,8,0,0,0-8,8v40a16,16,0,0,1-16,16H48a16,16,0,0,1-16-16V115.55a16,16,0,0,1,5.17-11.78l80-75.48.11-.11a16,16,0,0,1,21.53,0,1.14,1.14,0,0,0,.11.11l80,75.48A16,16,0,0,1,224,115.55Z"></path>
                    </svg>
                    <span>Feed</span>
                </a></li>
                <li><a href="explore.html" class="nav-link">
                    <svg class="shrink-0" fill="currentColor" height="24" viewBox="0 0 256 256" width="24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"></path>
                    </svg>
                    <span>Explore</span>
                </a></li>
                <li><a href="cupid.html" class="nav-link">
                    <svg class="shrink-0" fill="currentColor" height="24" viewBox="0 0 256 256" width="24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M128,216a8,8,0,0,1-5.66-2.34C58.34,159.4,24,129.74,24,96A64,64,0,0,1,128,32a64,64,0,0,1,104,64c0,33.74-34.34,63.4-98.34,117.66A8,8,0,0,1,128,216Z"></path>
                    </svg>
                    <span>Cupid</span>
                </a></li>
                <li><a href="message.html" class="nav-link">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><path d="m22 6l-10 7L2 6"/></g></svg>
                  <span>Message</span>
                </a></li>
                <li><a href="#" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></g></svg>
                    <span>Alumni</span>
                </a></li>
                <li><a href="code-connect.html" class="nav-link active">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="m16 18l6-6l-6-6"/><path d="m8 6l-6 6l6 6"/></g></svg>
                    <span>Code & Connect</span>
                </a></li>
              </ul>
            </nav>
            <a href="loginN.html" class="btn-logout">Logout</a>
        </div>
    </aside>

    

    <div class="main-wrapper">
        <main class="main-content">
            <h1>Top Coders & Developers</h1>
            <div class="coders-grid" id="coders-grid">
            </div>
        </main>

        <aside class="leaderboard-container">
            <div class="leaderboard-card">
                <h2>Institute Leaderboard</h2>
                <ul class="leaderboard-list" id="leaderboard-list">
                    </ul>
            </div>
        </aside>
    </div>
</div>
    <script>
  document.addEventListener('DOMContentLoaded', async () => {
    const supabaseUrl = "https://pbuyszhhtmgaubzylmoh.supabase.co"; // replace with your URL
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBidXlzemhodG1nYXVienlsbW9oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MDMyMDgsImV4cCI6MjA3NDM3OTIwOH0.EH7VsDZJWltw5c-dMkRab6-85ERhprXJ9uKAocco_jA"; // replace with your anon key
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    async function loadProfile() {
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
            console.error("No logged in user");
            return;
        }

        const { data: profile, error } = await supabase
            .from("profiles")
            .select("full_name, avatar_url, title")
            .eq("id", user.id) 
            .single();

        if (error) {
            console.error("Error loading profile:", error.message);
            return;
        }
        
        // Update DOM with fetched data
        document.getElementById("s-name").textContent = profile.full_name || "Unnamed User";
        document.getElementById("s-title").textContent = profile.title || "";
        
        document.querySelector(".profile-avatar-main").src = profile.avatar_url || "default-avatar.png";
    }
    loadProfile();

    const codersGrid = document.getElementById('coders-grid');
    const leaderboardList = document.getElementById('leaderboard-list');

    // --- FETCH CODERS FROM SUPABASE ---
    async function loadCoders() {
      const { data: coders, error } = await supabase
        .from('coders')
        .select('*')
        .order('score', { ascending: false });

        console.log(coders, error);
      if (error) {
        console.error('Error fetching coders:', error);
        return;
      }

      renderCoderCards(coders);
      renderLeaderboard(coders);
    }

    // --- RENDER FUNCTIONS ---
    function renderCoderCards(coders) {
      codersGrid.innerHTML = '';
      coders.forEach(coder => {
        const card = document.createElement('div');
        card.className = 'coder-card';
        card.innerHTML = `
          <div class="coder-profile">
            <img src="https://picsum.photos/seed/${coder.name.split(' ').join('')}/80" alt="${coder.name}" class="coder-avatar">
            <div class="coder-info">
              <h3>${coder.name}</h3>
              <p>${coder.title || ''}</p>
            </div>
          </div>
          <div class="coder-socials">
            <a href="${coder.github || '#'}" target="_blank" class="social-link" title="GitHub">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                </svg>
            </a>
            <a href="${coder.linkedin || '#'}" target="_blank" class="social-link" title="LinkedIn">
                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0 0 48 48">
                    <path fill="#0288D1" d="M42,37c0,2.762-2.238,5-5,5H11c-2.761,0-5-2.238-5-5V11c0-2.762,2.239-5,5-5h26c2.762,0,5,2.238,5,5V37z"></path><path fill="#FFF" d="M12 19H17V36H12zM14.485 17h-.028C12.965 17 12 15.888 12 14.499 12 13.08 12.995 12 14.514 12c1.521 0 2.458 1.08 2.486 2.499C17 15.887 16.035 17 14.485 17zM36 36h-5v-9.099c0-2.198-1.225-3.698-3.192-3.698-1.501 0-2.313 1.012-2.707 1.99C24.957 25.543 25 26.511 25 27v9h-5V19h5v2.616C25.721 20.5 26.85 19 29.738 19c3.578 0 6.261 2.25 6.261 7.274L36 36 36 36z"></path>
                </svg>
            </a>
            <a href="${coder.twitter || '#'}" target="_blank" class="social-link" title="X (Twitter)">
                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0 0 48 48">
                <path fill="#03A9F4" d="M42,12.429c-1.323,0.586-2.746,0.977-4.247,1.162c1.526-0.906,2.7-2.351,3.251-4.058c-1.428,0.837-3.01,1.452-4.693,1.776C34.967,9.884,33.05,9,30.926,9c-4.08,0-7.387,3.278-7.387,7.32c0,0.572,0.067,1.129,0.193,1.67c-6.138-0.308-11.582-3.226-15.224-7.654c-0.64,1.082-1,2.349-1,3.686c0,2.541,1.301,4.778,3.285,6.096c-1.211-0.037-2.351-0.374-3.349-0.914c0,0.022,0,0.055,0,0.086c0,3.551,2.547,6.508,5.923,7.181c-0.617,0.169-1.269,0.263-1.941,0.263c-0.477,0-0.942-0.054-1.392-0.135c0.94,2.902,3.667,5.023,6.898,5.086c-2.528,1.96-5.712,3.134-9.174,3.134c-0.598,0-1.183-0.034-1.761-0.104C9.268,36.786,13.152,38,17.321,38c13.585,0,21.017-11.156,21.017-20.834c0-0.317-0.01-0.633-0.025-0.945C39.763,15.197,41.013,13.905,42,12.429"></path>
                </svg>
            </a>
            <a href="${coder.leetcode || '#'}" target="_blank" class="social-link" title="LeetCode">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="leetcode">
                    <path fill="#B3B1B0" d="M22 14.355c0-.742-.564-1.346-1.26-1.346H10.676c-.696 0-1.26.604-1.26 1.346s.563 1.346 1.26 1.346H20.74c.696.001 1.26-.603 1.26-1.346z"></path>
                    <path fill="#E7A41F" d="m3.482 18.187 4.313 4.361c.973.979 2.318 1.452 3.803 1.452 1.485 0 2.83-.512 3.805-1.494l2.588-2.637c.51-.514.492-1.365-.039-1.9-.531-.535-1.375-.553-1.884-.039l-2.676 2.607c-.462.467-1.102.662-1.809.662s-1.346-.195-1.81-.662l-4.298-4.363c-.463-.467-.696-1.15-.696-1.863 0-.713.233-1.357.696-1.824l4.285-4.38c.463-.467 1.116-.645 1.822-.645s1.346.195 1.809.662l2.676 2.606c.51.515 1.354.497 1.885-.038.531-.536.549-1.387.039-1.901l-2.588-2.636a4.994 4.994 0 0 0-2.392-1.33l-.034-.007 2.447-2.503c.512-.514.494-1.366-.037-1.901-.531-.535-1.376-.552-1.887-.038l-10.018 10.1C2.509 11.458 2 12.813 2 14.311c0 1.498.509 2.896 1.482 3.876z"></path>
                    <path fill="#070706" d="M8.115 22.814a2.109 2.109 0 0 1-.474-.361c-1.327-1.333-2.66-2.66-3.984-3.997-1.989-2.008-2.302-4.937-.786-7.32a6 6 0 0 1 .839-1.004L13.333.489c.625-.626 1.498-.652 2.079-.067.56.563.527 1.455-.078 2.066-.769.776-1.539 1.55-2.309 2.325-.041.122-.14.2-.225.287-.863.876-1.75 1.729-2.601 2.618-.111.116-.262.186-.372.305-1.423 1.423-2.863 2.83-4.266 4.272-1.135 1.167-1.097 2.938.068 4.127 1.308 1.336 2.639 2.65 3.961 3.974.067.067.136.132.204.198.468.303.474 1.25.183 1.671-.321.465-.74.75-1.333.728-.199-.006-.363-.086-.529-.179z"></path>
                    </svg>
            </a>
            <a href="${coder.codeforces || '#'}" target="_blank" class="social-link" title="Codeforces">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="code-forces">
                <path fill="#F44336" d="M24 19.5V12a1.5 1.5 0 0 0-1.5-1.5h-3A1.5 1.5 0 0 0 18 12v7.5a1.5 1.5 0 0 0 1.5 1.5h3a1.5 1.5 0 0 0 1.5-1.5z"></path>
                <path fill="#2196F3" d="M13.5 21a1.5 1.5 0 0 0 1.5-1.5v-15A1.5 1.5 0 0 0 13.5 3h-3C9.673 3 9 3.672 9 4.5v15c0 .828.673 1.5 1.5 1.5h3z"></path>
                <path fill="#FFC107" d="M0 19.5c0 .828.673 1.5 1.5 1.5h3A1.5 1.5 0 0 0 6 19.5V9a1.5 1.5 0 0 0-1.5-1.5h-3C.673 7.5 0 8.172 0 9v10.5z"></path>
                </svg>
            </a>
          </div>
          <button class="view-profile-btn">View Profile</button>
        `;
        codersGrid.appendChild(card);
      });
    }

    function renderLeaderboard(coders) {
      leaderboardList.innerHTML = '';
      coders.forEach((coder, index) => {
        let rankClass = '';
        const rank = index + 1;
        if (rank === 1) rankClass = 'gold';
        else if (rank === 2) rankClass = 'silver';
        else if (rank === 3) rankClass = 'bronze';

        const item = document.createElement('li');
        item.className = 'leaderboard-item';
        item.innerHTML = `
          <span class="rank ${rankClass}">#${rank}</span>
          <img src="https://picsum.photos/seed/${coder.name.split(' ').join('')}/40" class="leaderboard-avatar" alt="${coder.name}">
          <span class="leaderboard-name">${coder.name}</span>
          <span class="leaderboard-score">${coder.score || 0} pts</span>
        `;
        leaderboardList.appendChild(item);
      });
    }

    // --- INITIAL LOAD ---
    await loadCoders();
  });
</script>

</body>
</html>